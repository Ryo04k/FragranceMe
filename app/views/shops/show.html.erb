<div class="max-w-[1200px] mx-auto">
  <h2 class="text-xl md:text-3xl font-bold mt-6 ml-2 md:ml-0"><%= @shop.name %></h2>
  <div class="flex items-center mb-2 ml-2 md:ml-0">
    <% full_stars = @shop.rating.floor %>
    <% half_star = @shop.rating - full_stars >= 0.5 %>

    <% (1..5).each do |i| %>
      <% if i <= full_stars %>
        <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 15l-5.878 3.09 1.122-6.534L0 6.236l6.545-.954L10 0l2.455 5.282L20 6.236l-5.244 5.32 1.122 6.534z" />
        </svg>
      <% elsif half_star && i == full_stars + 1 %>
        <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
          <defs>
            <mask id="right-half-star">
              <rect width="100%" height="100%" fill="white" />
              <rect x="50%" width="50%" height="100%" fill="black" />
            </mask>
          </defs>
          <path d="M10 15l-5.878 3.09 1.122-6.534L0 6.236l6.545-.954L10 0l2.455 5.282L20 6.236l-5.244 5.32 1.122 6.534z" fill="currentColor" mask="url(#right-half-star)" />
          <path d="M10 15l-5.878 3.09 1.122-6.534L0 6.236l6.545-.954L10 0l2.455 5.282L20 6.236l-5.244 5.32 1.122 6.534z" fill="currentColor" opacity="0.5" />
        </svg>
      <% else %>
        <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" opacity="0.5">
          <path d="M10 15l-5.878 3.09 1.122-6.534L0 6.236l6.545-.954L10 0l2.455 5.282L20 6.236l-5.244 5.32 1.122 6.534z" />
        </svg>
      <% end %>
    <% end %>
    <p class="text-lg text-white font-semibold py-1 px-2 rounded-full text-yellow-400"><%= @shop.rating %></p>
  </div>

  <!-- スライダー -->
  <div class="swiper slider mb-2 md:w-full">
    <div class="swiper-wrapper w-full">
      <% @shop_images.each do |image_url| %>
        <div class="swiper-slide">
          <img src="<%= image_url %>" alt="店舗画像" class="w-full h-full object-cover">
        </div>
      <% end %>
    </div>
    <!-- 前後の矢印 -->
    <div class="swiper-button-next text-white p-2 rounded-full"></div>
    <div class="swiper-button-prev text-white p-2 rounded-full"></div>
  </div>

  <!-- サムネイル -->
  <div class="swiper slider-thumbnail">
    <div class="swiper-wrapper">
      <% @shop_images.each do |image_url| %>
        <div class="mr-2 swiper-slide opacity-50 transition-opacity duration-500 w-1/3 md:w-1/2">
          <img src="<%= image_url %>" alt="店舗画像" class="w-full h-28 object-cover">
        </div>
      <% end %>
    </div>
  </div>

  <% if @shop.opening_hours.present? %>
    <div class="py-8 border-b border-gray-300 flex flex-col md:flex-row items-start px-4">
      <p class="text-base font-bold w-full md:w-40 flex items-start mb-2 md:mb-0 items-center">
        <span class="material-symbols-outlined mr-2">schedule</span> 営業時間
      </p>
      <div class="text-base w-full md:w-auto">
        <%= @shop.opening_hours.gsub("\n", "<br>").html_safe %>
      </div>
    </div>
  <% end %>

  <% if @shop.phone_number.present? %>
    <div class="py-8 border-b border-gray-300 flex flex-col md:flex-row px-4">
      <p class="text-base font-bold w-full md:w-40 flex mb-2 md:mb-0 items-center">
        <span class="material-symbols-outlined mr-2">call</span> 電話番号
      </p>
      <p class="text-base w-full md:w-auto"><%= @shop.phone_number %></p>
    </div>
  <% end %>

  <% if @shop.web_site.present? %>
    <div class="border-b border-gray-300 py-8 flex flex-col md:flex-row px-4">
      <p class="text-base font-bold w-full md:w-40 flex mb-2 md:mb-0 items-center">
        <span class="material-symbols-outlined mr-2">desktop_windows</span> Webサイト
      </p>
      <%= link_to @shop.web_site, @shop.web_site, class: "text-base w-full md:w-auto", target: :_blank %>
    </div>
  <% end %>

  <% if @shop.address.present? && @shop.postal_code.present? %>
    <div class="py-8 flex flex-col md:flex-row px-4">
      <p class="text-base font-bold w-full md:w-40 flex mb-2 md:mb-0 items-center">
        <span class="material-symbols-outlined mr-2">pin_drop</span> 住所
      </p>
      <p class="text-base w-full md:w-auto"><%= @shop.postal_code %><br><%= @shop.address %></p>
    </div>
  <% end %>

</div>

<style>
  .slider-thumbnail .swiper-slide.swiper-slide-thumb-active {
    opacity: 1;
  }
  .swiper.slider {
    height: 400px;
  }
</style>

<script type="text/javascript">
  document.addEventListener('turbo:load', function() {
    const sliderThumbnail = new Swiper(".slider-thumbnail", {
      slidesPerView: 4,
    });
    const slider = new Swiper(".slider", {
      loop: true,
      effect: "fade",
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      thumbs: {
        swiper: sliderThumbnail,
      },
    });
  });
</script>
