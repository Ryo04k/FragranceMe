<div class="max-w-[1200px] mx-auto mb-20">
  <h2 class="text-2xl md:text-3xl font-bold mt-6 mb-1 ml-2 md:ml-0"><%= @shop.name %></h2>
  <div class="flex items-center mb-2 ml-2 md:ml-0">
    <% full_stars = @shop.rating.floor %>
    <% half_star = @shop.rating - full_stars >= 0.5 %>
    <%= render_rating(@shop, text_size: "text-lg", svg_size: "w-5 h-5") %>
  </div>

  <!-- スライダー -->
  <div class="swiper slider mb-2 md:w-full h-72 md:h-96">
    <div class="swiper-wrapper w-full">
      <% @shop_images.each do |image_url| %>
        <div class="swiper-slide">
          <img src="<%= image_url %>" alt="店舗画像" class="w-full h-full object-cover">
        </div>
      <% end %>
    </div>
    <!-- 前後の矢印 -->
    <div class="swiper-button-next text-white p-2 rounded-full"></div>
    <div class="swiper-button-prev text-white p-2 rounded-full"></div>
  </div>

  <!-- サムネイル -->
  <div class="swiper slider-thumbnail">
    <div class="swiper-wrapper">
      <% @shop_images.each do |image_url| %>
        <div class="mr-2 swiper-slide opacity-50 transition-opacity duration-500 w-1/4 sm:w-1/3 md:w-1/4 lg:w-1/5">
          <img src="<%= image_url %>" alt="店舗画像" class="w-full h-28 object-cover">
        </div>
      <% end %>
    </div>
  </div>

  <div role="tablist" class="tabs tabs-bordered mt-3">
    <a role="tab" class="tab tab-active text-base font-semibold" id="shopDetailsTab" onclick="showTab('shopDetailsContent')">ショップ詳細</a>
    <a role="tab" class="tab text-base font-semibold" id="reviewsTab" onclick="showTab('reviewsContent')">口コミ</a>
  </div>

  <!-- ショップ詳細コンテンツ -->
  <div id="shopDetailsContent" class="block">
    <% if @shop.opening_hours.present? %>
      <div class="py-8 border-b border-gray-300 flex flex-col md:flex-row items-start px-4">
        <p class="text-base font-bold w-full md:w-40 flex items-start mb-2 md:mb-0 items-center">
          <span class="material-symbols-outlined mr-2">schedule</span> 営業時間
        </p>
        <div class="text-base w-full md:w-auto">
          <%= sanitize(@shop.opening_hours.gsub("\n", "<br>")) %>
        </div>
      </div>
    <% end %>

    <% if @shop.phone_number.present? %>
      <div class="py-8 border-b border-gray-300 flex flex-col md:flex-row px-4">
        <p class="text-base font-bold w-full md:w-40 flex mb-2 md:mb-0 items-center">
          <span class="material-symbols-outlined mr-2">call</span> 電話番号
        </p>
        <p class="text-base w-full md:w-auto"><%= @shop.phone_number %></p>
      </div>
    <% end %>

    <% if @shop.web_site.present? %>
      <div class="py-8 border-b border-gray-300 flex flex-col md:flex-row px-4">
        <p class="text-base font-bold w-full md:w-40 flex mb-2 md:mb-0 items-center">
          <span class="material-symbols-outlined mr-2">desktop_windows</span> Webサイト
        </p>
        <%= link_to @shop.web_site.to_s, @shop.web_site.to_s, class: "text-base w-full md:w-auto", target: :_blank, rel: "noopener noreferrer" %>
      </div>
    <% end %>

    <% if @shop.address.present? && @shop.postal_code.present? %>
      <div class="py-8 flex flex-col md:flex-row px-4">
        <p class="text-base font-bold w-full md:w-40 flex mb-2 md:mb-0 items-center">
          <span class="material-symbols-outlined mr-2">pin_drop</span> 住所
        </p>
        <p class="text-base w-full md:w-auto"><%= @shop.postal_code %><br><%= @shop.address %></p>
      </div>
    <% end %>

    <iframe
      frameborder="0"
      class="w-full md:h-64 h-48"
      src="https://www.google.com/maps/embed/v1/place?key=<%= GoogleApi.api_key %>&q=<%= CGI.escape(@shop.name) %>,<%= CGI.escape(@shop.address) %>">
    </iframe>

    <div class="flex justify-end mt-5 mr-2 md:mr-0">
      <%= link_to "https://www.google.com/maps/search/?api=1&query=#{CGI.escape(@shop.name)},#{CGI.escape(@shop.address)}", target: :_blank, class: "text-xs btn btn-outline" do %>
        <span class="material-symbols-outlined">map_search</span>
        <span>GoogleMapで開く</span>
      <% end %>
    </div>
  </div>

  <!-- 口コミコンテンツ -->
  <div id="reviewsContent" class="hidden">
    <p>口コミ内容</p>
  </div>
</div>

<style>
  .slider-thumbnail .swiper-slide.swiper-slide-thumb-active {
    opacity: 1;
  }
</style>

<script type="text/javascript">
  document.addEventListener('turbo:load', function() {
    const sliderThumbnail = new Swiper(".slider-thumbnail", {
      slidesPerView: 4,
    });
    const slider = new Swiper(".slider", {
      loop: true,
      effect: "fade",
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      thumbs: {
        swiper: sliderThumbnail,
      },
    });
  });
</script>

<script type="text/javascript">
  function showTab(tabContentId) {
    // すべてのタブコンテンツを非表示にする
    const contents = document.querySelectorAll('div[id$="Content"]'); // IDがContentで終わる要素を選択
    contents.forEach(content => {
      content.classList.add('hidden'); // hiddenクラスを追加
    });

    // 選択されたタブのコンテンツを表示する
    const selectedContent = document.getElementById(tabContentId);
    selectedContent.classList.remove('hidden'); // hiddenクラスを削除

    // すべてのタブのアクティブクラスを削除
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
      tab.classList.remove('tab-active');
    });

    // クリックされたタブにアクティブクラスを追加
    const activeTab = document.querySelector(`[onclick="showTab('${tabContentId}')"]`);
    if (activeTab) {
      activeTab.classList.add('tab-active');
    }
  }

</script>